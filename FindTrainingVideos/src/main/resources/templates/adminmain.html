<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin - Training Videos</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function() {
             fetch('/getDisciplines', {headers: { 'Authorization': `${localStorage.getItem('token')}`,  }})
                 .then((response) => { return response.json();})
                 .then(pdata => {
                     let tr = '';
                     pdata.forEach(value => {
                         tr += `<option value="${value.id}">${value.name}</option>`;
                     })
                     document.querySelector('#disciplinesSelect').innerHTML = tr;
                     document.querySelector('#editDisciplinesSelect').innerHTML = tr;
                 });

            fetch('/adminmain/getVideoList', {headers: { 'Authorization': `${localStorage.getItem('token')}`,  }})
                .then((response) => { return response.json();})
                .then(pdata => {
                    let tr = '';
                    pdata.forEach(function (value) {
                        tr += `<tr>
                                   <td>${value.title}</td>
                                   <td>${value.theme}</td>
                                   <td>${value.author}</td>
                                   <td>${value.date.toString()}</td>
                                   <td>${value.url}</td>
                                   <td>${value.description}</td>
                                   <td><a href="javascript:editVideo(${value.id});"><img src="https://img.icons8.com/ios/50/000000/edit--v1.png" width="20"/></a></td>
                                   <td><a href="javascript:deleteVideo(${value.id});"><img src="https://img.icons8.com/windows/32/000000/delete-sign.png" width="20"/></a></td>
                               </tr>`;
                    });
                    document.querySelector('#table_id tbody:nth-child(2)').innerHTML = tr; //Append the data
                }).then().catch(error => {console.log(error);
            });
        });
    </script>
</head>
<body>
<div class="container">
    <nav class="navbar navbar-light bg-success justify-content-between" style="margin: 10px;">
        <a class="navbar-brand text-light" href="#">
            <img src="https://img.icons8.com/material-two-tone/24/000000/video.png" width="30" height="30" class="d-inline-block align-top" alt="">
            Training Videos - Admin
        </a>
    </nav>
    <div class="row">
        <div class="col-4 container">
            <h3 style="padding: 10px;">Add a video</h3>
            <div class="col rounded bg-light" style=" padding: 10px;">
                <div class="form-group">
                    <label for="videotitle">Title</label>
                    <input type="text" name="videotitle" id="videotitle" class="form-control">
                </div>
                <div class="form-group">
                    <label for="videotheme">Theme</label>
                    <input type="text" name="videotheme" id="videotheme" class="form-control">
                </div>
                <div class="form-group">
                    <label for="videoauthor">Author</label>
                    <input type="text" name="videoauthor" id="videoauthor" class="form-control">
                </div>
                <div class="dropdown">
                    <select class="form-select" aria-label="Discipline" id ="disciplinesSelect" >
                        <option selected>Select discipline</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="videourl">URL</label>
                    <input type="text" name="videourl" id="videourl" class="form-control">
                </div>
                <div class="form-group">
                    <label for="videodescription">Description</label>
                    <input type="text" name="videodescription" id="videodescription" class="form-control">
                </div>
                <input type="submit" value="Add" class="btn btn-success" onclick="addVideo()"/>
            </div>
        </div>
        <div class="col-4 container">
            <h3 style="padding: 10px;">Edit a video</h3>
            <div class="col rounded bg-light" style=" padding: 10px;">
                <div class="form-group">
                    <label for="editvideotitle">Title</label>
                    <input type="text" name="editvideotitle" id="editvideotitle" class="form-control">
                </div>
                <div class="form-group">
                    <label for="editvideotheme">Theme</label>
                    <input type="text" name="editvideotheme" id="editvideotheme" class="form-control">
                </div>
                <div class="form-group">
                    <label for="editvideoauthor">Author</label>
                    <input type="text" name="editvideoauthor" id="editvideoauthor" class="form-control">
                </div>
                <div class="dropdown">
                    <select class="form-select" aria-label="Discipline" id ="editDisciplinesSelect" >
                        <option selected>Select discipline</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editvideourl">URL</label>
                    <input type="text" name="editvideourl" id="editvideourl" class="form-control">
                </div>
                <div class="form-group">
                    <label for="editvideodescription">Description</label>
                    <input type="text" name="editvideodescription" id="editvideodescription" class="form-control">
                </div>
                <input type="submit" value="Edit" class="btn btn-success" onclick="editVideo(id)"/>
            </div>
        </div>
        <div class="col container" width="600">
            <h3 style="padding: 10px;">List</h3>
            <table class="table" id="table_id">
                <tbody>
                <tr class="bg-light">
                    <th>Title</th>
                    <th>Theme</th>
                    <!--  <th>Discipline</th>-->
                    <th>Author</th>
                    <th>Date</th>
                    <th>URL</th>
                    <th>Description</th>
                    <th>edit</th>
                    <th>delete</th>
                </tr>
                </tbody>
                <tbody/>
            </table>
        </div>
    </div>
</div>
<script>
    async function addVideo() {
        let videotitle = document.getElementById("videotitle").value;
        let videotheme = document.getElementById("videotheme").value;
        let videoauthor = document.getElementById("videoauthor").value;
        let videodisciplineId  = $('#disciplinesSelect option:selected').val();
        let videourl = document.getElementById("videourl").value;
        let videodescription = document.getElementById("videodescription").value;
        let response = await fetch("/adminmain/addvideo",
            {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'Authorization': `${localStorage.getItem('token')}`
                },
                body: JSON.stringify({
                    title: videotitle,
                    theme: videotheme,
                    author: videoauthor,
                    disciplineId: videodisciplineId,
                    url: videourl,
                    description: videodescription
                })
            });

        if (response.status === 200) {

        } else {
            alert(response.statusText);
            /*document.querySelector("#result").style.color = "#e74c3c";
            document.querySelector("#result").innerHTML = data.error;*/
        }
    }
    async function deleteVideo(id) {
        fetch(`adminmain/deletevideo/${id}`,  {method: 'DELETE', headers: { 'Authorization': `${localStorage.getItem('token')}`}});
    }
    async function editVideo(id) {
        let editvideotitle = document.getElementById("editvideotitle").value;
        let editvideotheme = document.getElementById("editvideotheme").value;
        let editvideoauthor = document.getElementById("editvideoauthor").value;
        let editvideodisciplineId  = $('#editDisciplinesSelect option:selected').val();
        let editvideourl = document.getElementById("editvideourl").value;
        let editvideodescription = document.getElementById("editvideodescription").value;
        fetch(`adminmain/editvideo/${id}`, {
            method: 'PUT',
            headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
            'Authorization': `${localStorage.getItem('token')}`
            },
            body: JSON.stringify({
                title: editvideotitle,
                theme: editvideotheme,
                disciplineId: editvideodisciplineId,
                author: editvideoauthor,
                url: editvideourl,
                description: editvideodescription
            })
        });
    }
</script>
</body>
</html>